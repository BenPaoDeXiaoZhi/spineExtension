(function(ce){typeof define=="function"&&define.amd?define(ce):ce()})((function(){"use strict";function ce(e){if(!e||!e.getInfo)throw new Error("ext.getInfo is not defined");const t=e.getInfo();console.group(`register extension ${t.id}`);function n(r){console.error(`register extension ${t.id}: ${r}`)}for(let r of t.blocks){e[r.opcode]||(n(`未设置的opcode function:${r.opcode}`),e[r.opcode]=()=>{console.error(`当前opcode:${r.opcode}函数未定义!`)});for(let i of r.text.match(new RegExp("(?<=\\[).+?(?=\\])","g"))||[]){if(!r.arguments){n(`块${r.opcode}未设置arguments`);break}r.arguments[i]||n(`块${r.opcode}未设置参数${i}`)}}for(let r in t.menus||{}){const i=t.menus[r];i.items instanceof Array||e[i.items]||(n(`menu${r}的items函数未设置`),e[i.items]=()=>({text:"未设置！！！",value:"not setted"}))}console.groupEnd(),Scratch.extensions.register(e)}const bt={"spineAnimation.extensionName":"spine骨骼动画","spineAnimation.showRuntime.text":"console输出runtime信息并保存至window._runtime","spineAnimation.pass.text":"直接执行reporter[A]","spineAnimation.setSkinId.text":"将角色[TARGET_NAME]的skin设为ID为[SKIN_ID]的skin","spineAnimation.spriteMenu.currentTarget":"当前角色","spineAnimation.loadSkeleton.text":"加载id为[ID]的spine骨骼"},Et={"spineAnimation.extensionName":"spine animation","spineAnimation.showRuntime.text":"Print scratch runtime and assign to window._runtime","spineAnimation.pass.text":"Run reporter[A] and ignore the return value","spineAnimation.setSkinId.text":"Set the skin of character [TARGET_NAME] to the skin with ID [SKIN_ID]","spineAnimation.spriteMenu.currentTarget":"Current target","spineAnimation.loadSkeleton.text":"load spine skeleton with id:[ID]"};function kt(e){const t=e.getFormatMessage({"zh-cn":bt,en:Et});return function(n,r){return t({default:n},r)}}class xt{constructor(t,n){this.info={id:t,name:n,blocks:[],menus:{}}}getInfo(){return this.info}buildBlock(t,n,r,i={}){let s;t instanceof Function?s=t.name:s=t;const o={opcode:s,text:n,blockType:r};Object.assign(o,i),this.info.blocks.push(o)}buildButton(t,n){let r;t instanceof Function?r=t.name:r=t,this.info.blocks.push({opcode:r,text:n,blockType:Scratch.BlockType.BUTTON,func:r})}buildMenu(t,n,r){if(r instanceof Function){const i=r.name||`menu_${t}`;this[i]??=r,this.info.menus[t]={acceptReporters:n,items:i}}else this.info.menus[t]={acceptReporters:n,items:r}}}const xe=!1;var At=Array.isArray,St=Array.prototype.indexOf,Tt=Array.from,It=Object.defineProperty,re=Object.getOwnPropertyDescriptor,Nt=Object.prototype,Rt=Array.prototype,Dt=Object.getPrototypeOf,Be=Object.isExtensible;function Mt(e){for(var t=0;t<e.length;t++)e[t]()}function Ft(){var e,t,n=new Promise((r,i)=>{e=r,t=i});return{promise:n,resolve:e,reject:t}}const p=2,Ae=4,Ct=8,C=16,K=32,G=64,he=128,I=512,w=1024,x=2048,O=4096,$=8192,V=16384,$e=32768,_e=65536,Ue=1<<17,Le=1<<18,de=1<<19,Ot=1<<20,Y=32768,Se=1<<21,qe=1<<22,ie=1<<23,Te=Symbol("$state"),je=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Pt(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Bt(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function $t(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ut(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Lt(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const qt=2,y=Symbol();function jt(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Kt(e){return e===this.v}let Ie=!1,Gt=!1;function Vt(){Ie=!0}let N=null;function ve(e){N=e}function Yt(e,t=!1,n){N={p:N,i:!1,c:null,e:null,s:e,x:null,l:Ie&&!t?{s:null,u:null,$:[]}:null}}function zt(e){var t=N,n=t.e;if(n!==null){t.e=null;for(var r of n)fn(r)}return t.i=!0,N=t.p,{}}function pe(){return!Ie||N!==null&&N.l===null}let Q=[];function Ht(){var e=Q;Q=[],Mt(e)}function Ne(e){if(Q.length===0){var t=Q;queueMicrotask(()=>{t===Q&&Ht()})}Q.push(e)}function Ke(e){var t=v;if(t===null)return d.f|=ie,e;if((t.f&$e)===0){if((t.f&he)===0)throw e;t.b.error(e)}else me(e,t)}function me(e,t){for(;t!==null;){if((t.f&he)!==0)try{t.b.error(e);return}catch(n){e=n}t=t.parent}throw e}const ge=new Set;let b=null,A=null,R=[],Re=null,De=!1;class D{committed=!1;current=new Map;previous=new Map;#n=new Set;#r=new Set;#c=0;#s=0;#o=null;#l=[];#i=[];skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#s>0}process(t){R=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const r of t)this.#e(r,n);this.is_fork||this.#u(),this.is_deferred()?(this.#t(n.effects),this.#t(n.render_effects),this.#t(n.block_effects)):(b=null,Ge(n.render_effects),Ge(n.effects),this.#o?.resolve()),A=null}#e(t,n){t.f^=w;for(var r=t.first;r!==null;){var i=r.f,s=(i&(K|G))!==0,o=s&&(i&w)!==0,u=o||(i&$)!==0||this.skipped_effects.has(r);if((r.f&he)!==0&&r.b?.is_pending()&&(n={parent:n,effect:r,effects:[],render_effects:[],block_effects:[]}),!u&&r.fn!==null){s?r.f^=w:(i&Ae)!==0?n.effects.push(r):ue(r)&&((r.f&C)!==0&&n.block_effects.push(r),ae(r));var l=r.first;if(l!==null){r=l;continue}}var f=r.parent;for(r=r.next;r===null&&f!==null;)f===n.effect&&(this.#t(n.effects),this.#t(n.render_effects),this.#t(n.block_effects),n=n.parent),r=f.next,f=f.parent}}#t(t){for(const n of t)((n.f&x)!==0?this.#l:this.#i).push(n),this.#f(n.deps),E(n,w)}#f(t){if(t!==null)for(const n of t)(n.f&p)===0||(n.f&Y)===0||(n.f^=Y,this.#f(n.deps))}capture(t,n){this.previous.has(t)||this.previous.set(t,n),(t.f&ie)===0&&(this.current.set(t,t.v),A?.set(t,t.v))}activate(){b=this,this.apply()}deactivate(){b===this&&(b=null,A=null)}flush(){if(this.activate(),R.length>0){if(Wt(),b!==null&&b!==this)return}else this.#c===0&&this.process([]);this.deactivate()}discard(){for(const t of this.#r)t(this);this.#r.clear()}#u(){if(this.#s===0){for(const t of this.#n)t();this.#n.clear()}this.#c===0&&this.#a()}#a(){if(ge.size>1){this.previous.clear();var t=A,n=!0,r={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const s of ge){if(s===this){n=!1;continue}const o=[];for(const[l,f]of this.current){if(s.current.has(l))if(n&&f!==s.current.get(l))s.current.set(l,f);else continue;o.push(l)}if(o.length===0)continue;const u=[...s.current.keys()].filter(l=>!this.current.has(l));if(u.length>0){var i=R;R=[];const l=new Set,f=new Map;for(const h of o)Ve(h,u,l,f);if(R.length>0){b=s,s.apply();for(const h of R)s.#e(h,r);s.deactivate()}R=i}}b=null,A=t}this.committed=!0,ge.delete(this)}increment(t){this.#c+=1,t&&(this.#s+=1)}decrement(t){this.#c-=1,t&&(this.#s-=1),this.revive()}revive(){for(const t of this.#l)E(t,x),X(t);for(const t of this.#i)E(t,O),X(t);this.#l=[],this.#i=[],this.flush()}oncommit(t){this.#n.add(t)}ondiscard(t){this.#r.add(t)}settled(){return(this.#o??=Ft()).promise}static ensure(){if(b===null){const t=b=new D;ge.add(b),D.enqueue(()=>{b===t&&t.flush()})}return b}static enqueue(t){Ne(t)}apply(){}}function Wt(){var e=q;De=!0;var t=null;try{var n=0;for(be(!0);R.length>0;){var r=D.ensure();if(n++>1e3){var i,s;Zt()}r.process(R),U.clear()}}finally{De=!1,be(e),Re=null}}function Zt(){try{Pt()}catch(e){me(e,Re)}}let P=null;function Ge(e){var t=e.length;if(t!==0){for(var n=0;n<t;){var r=e[n++];if((r.f&(V|$))===0&&ue(r)&&(P=new Set,ae(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?ft(r):r.fn=null),P?.size>0)){U.clear();for(const i of P){if((i.f&(V|$))!==0)continue;const s=[i];let o=i.parent;for(;o!==null;)P.has(o)&&(P.delete(o),s.push(o)),o=o.parent;for(let u=s.length-1;u>=0;u--){const l=s[u];(l.f&(V|$))===0&&ae(l)}}P.clear()}}P=null}}function Ve(e,t,n,r){if(!n.has(e)&&(n.add(e),e.reactions!==null))for(const i of e.reactions){const s=i.f;(s&p)!==0?Ve(i,t,n,r):(s&(qe|C))!==0&&(s&x)===0&&Ye(i,t,r)&&(E(i,x),X(i))}}function Ye(e,t,n){const r=n.get(e);if(r!==void 0)return r;if(e.deps!==null)for(const i of e.deps){if(t.includes(i))return!0;if((i.f&p)!==0&&Ye(i,t,n))return n.set(i,!0),!0}return n.set(e,!1),!1}function X(e){for(var t=Re=e;t.parent!==null;){t=t.parent;var n=t.f;if(De&&t===v&&(n&C)!==0&&(n&Le)===0)return;if((n&(G|K))!==0){if((n&w)===0)return;t.f^=w}}R.push(t)}function Jt(e){let t=0,n=Ce(0),r;return()=>{we()&&(te(n),an(()=>(t===0&&(r=wn(()=>e(()=>se(n)))),t+=1,()=>{Ne(()=>{t-=1,t===0&&(r?.(),r=void 0,se(n))})})))}}var Qt=_e|de|he;function Xt(e,t,n){new en(e,t,n)}class en{parent;#n=!1;#r;#c=null;#s;#o;#l;#i=null;#e=null;#t=null;#f=null;#u=null;#a=0;#h=0;#d=!1;#_=null;#w=Jt(()=>(this.#_=Ce(this.#a),()=>{this.#_=null}));constructor(t,n,r){this.#r=t,this.#s=n,this.#o=r,this.parent=v.b,this.#n=!!this.#s.pending,this.#l=cn(()=>{v.b=this;{var i=this.#m();try{this.#i=H(()=>r(i))}catch(s){this.error(s)}this.#h>0?this.#p():this.#n=!1}return()=>{this.#u?.remove()}},Qt)}#y(){try{this.#i=H(()=>this.#o(this.#r))}catch(t){this.error(t)}this.#n=!1}#b(){const t=this.#s.pending;t&&(this.#e=H(()=>t(this.#r)),D.enqueue(()=>{var n=this.#m();this.#i=this.#v(()=>(D.ensure(),H(()=>this.#o(n)))),this.#h>0?this.#p():(ye(this.#e,()=>{this.#e=null}),this.#n=!1)}))}#m(){var t=this.#r;return this.#n&&(this.#u=nt(),this.#r.before(this.#u),t=this.#u),t}is_pending(){return this.#n||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#s.pending}#v(t){var n=v,r=d,i=N;j(this.#l),S(this.#l),ve(this.#l.ctx);try{return t()}catch(s){return Ke(s),null}finally{j(n),S(r),ve(i)}}#p(){const t=this.#s.pending;this.#i!==null&&(this.#f=document.createDocumentFragment(),this.#f.append(this.#u),vn(this.#i,this.#f)),this.#e===null&&(this.#e=H(()=>t(this.#r)))}#g(t){if(!this.has_pending_snippet()){this.parent&&this.parent.#g(t);return}this.#h+=t,this.#h===0&&(this.#n=!1,this.#e&&ye(this.#e,()=>{this.#e=null}),this.#f&&(this.#r.before(this.#f),this.#f=null))}update_pending_count(t){this.#g(t),this.#a+=t,this.#_&&Ze(this.#_,this.#a)}get_effect_pending(){return this.#w(),te(this.#_)}error(t){var n=this.#s.onerror;let r=this.#s.failed;if(this.#d||!n&&!r)throw t;this.#i&&(M(this.#i),this.#i=null),this.#e&&(M(this.#e),this.#e=null),this.#t&&(M(this.#t),this.#t=null);var i=!1,s=!1;const o=()=>{if(i){jt();return}i=!0,s&&Lt(),D.ensure(),this.#a=0,this.#t!==null&&ye(this.#t,()=>{this.#t=null}),this.#n=this.has_pending_snippet(),this.#i=this.#v(()=>(this.#d=!1,H(()=>this.#o(this.#r)))),this.#h>0?this.#p():this.#n=!1};var u=d;try{S(null),s=!0,n?.(t,o),s=!1}catch(l){me(l,this.#l&&this.#l.parent)}finally{S(u)}r&&Ne(()=>{this.#t=this.#v(()=>{D.ensure(),this.#d=!0;try{return H(()=>{r(this.#r,()=>t,()=>o)})}catch(l){return me(l,this.#l.parent),null}finally{this.#d=!1}})})}}function ze(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)M(t[n])}}function tn(e){for(var t=e.parent;t!==null;){if((t.f&p)===0)return(t.f&V)===0?t:null;t=t.parent}return null}function Me(e){var t,n=v;j(tn(e));try{e.f&=~Y,ze(e),t=dt(e)}finally{j(n)}return t}function He(e){var t=Me(e);if(e.equals(t)||(b?.is_fork||(e.v=t),e.wv=ht()),!fe)if(A!==null)we()&&A.set(e,t);else{var n=(e.f&I)===0?O:w;E(e,n)}}let Fe=new Set;const U=new Map;let We=!1;function Ce(e,t){var n={f:0,v:e,reactions:null,equals:Kt,rv:0,wv:0};return n}function L(e,t){const n=Ce(e);return pn(n),n}function z(e,t,n=!1){d!==null&&(!F||(d.f&Ue)!==0)&&pe()&&(d.f&(p|C|qe|Ue))!==0&&!B?.includes(e)&&Ut();let r=n?le(t):t;return Ze(e,r)}function Ze(e,t){if(!e.equals(t)){var n=e.v;fe?U.set(e,t):U.set(e,n),e.v=t;var r=D.ensure();r.capture(e,n),(e.f&p)!==0&&((e.f&x)!==0&&Me(e),E(e,(e.f&I)!==0?w:O)),e.wv=ht(),Je(e,x),pe()&&v!==null&&(v.f&w)!==0&&(v.f&(K|G))===0&&(T===null?mn([e]):T.push(e)),!r.is_fork&&Fe.size>0&&!We&&nn()}return t}function nn(){We=!1;var e=q;be(!0);const t=Array.from(Fe);try{for(const n of t)(n.f&w)!==0&&E(n,O),ue(n)&&ae(n)}finally{be(e)}Fe.clear()}function se(e){z(e,e.v+1)}function Je(e,t){var n=e.reactions;if(n!==null)for(var r=pe(),i=n.length,s=0;s<i;s++){var o=n[s],u=o.f;if(!(!r&&o===v)){var l=(u&x)===0;if(l&&E(o,t),(u&p)!==0){var f=o;A?.delete(f),(u&Y)===0&&(u&I&&(o.f|=Y),Je(f,O))}else l&&((u&C)!==0&&P!==null&&P.add(o),X(o))}}}function le(e){if(typeof e!="object"||e===null||Te in e)return e;const t=Dt(e);if(t!==Nt&&t!==Rt)return e;var n=new Map,r=At(e),i=L(0),s=W,o=u=>{if(W===s)return u();var l=d,f=W;S(null),ct(s);var h=u();return S(l),ct(f),h};return r&&n.set("length",L(e.length)),new Proxy(e,{defineProperty(u,l,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Bt();var h=n.get(l);return h===void 0?h=o(()=>{var _=L(f.value);return n.set(l,_),_}):z(h,f.value,!0),!0},deleteProperty(u,l){var f=n.get(l);if(f===void 0){if(l in u){const h=o(()=>L(y));n.set(l,h),se(i)}}else z(f,y),se(i);return!0},get(u,l,f){if(l===Te)return e;var h=n.get(l),_=l in u;if(h===void 0&&(!_||re(u,l)?.writable)&&(h=o(()=>{var c=le(_?u[l]:y),g=L(c);return g}),n.set(l,h)),h!==void 0){var a=te(h);return a===y?void 0:a}return Reflect.get(u,l,f)},getOwnPropertyDescriptor(u,l){var f=Reflect.getOwnPropertyDescriptor(u,l);if(f&&"value"in f){var h=n.get(l);h&&(f.value=te(h))}else if(f===void 0){var _=n.get(l),a=_?.v;if(_!==void 0&&a!==y)return{enumerable:!0,configurable:!0,value:a,writable:!0}}return f},has(u,l){if(l===Te)return!0;var f=n.get(l),h=f!==void 0&&f.v!==y||Reflect.has(u,l);if(f!==void 0||v!==null&&(!h||re(u,l)?.writable)){f===void 0&&(f=o(()=>{var a=h?le(u[l]):y,c=L(a);return c}),n.set(l,f));var _=te(f);if(_===y)return!1}return h},set(u,l,f,h){var _=n.get(l),a=l in u;if(r&&l==="length")for(var c=f;c<_.v;c+=1){var g=n.get(c+"");g!==void 0?z(g,y):c in u&&(g=o(()=>L(y)),n.set(c+"",g))}if(_===void 0)(!a||re(u,l)?.writable)&&(_=o(()=>L(void 0)),z(_,le(f)),n.set(l,_));else{a=_.v!==y;var Z=o(()=>le(f));z(_,Z)}var J=Reflect.getOwnPropertyDescriptor(u,l);if(J?.set&&J.set.call(h,f),!a){if(r&&typeof l=="string"){var yt=n.get("length"),Pe=Number(l);Number.isInteger(Pe)&&Pe>=yt.v&&z(yt,Pe+1)}se(i)}return!0},ownKeys(u){te(i);var l=Reflect.ownKeys(u).filter(_=>{var a=n.get(_);return a===void 0||a.v!==y});for(var[f,h]of n)h.v!==y&&!(f in u)&&l.push(f);return l},setPrototypeOf(){$t()}})}var Qe,Xe,et,tt;function rn(){if(Qe===void 0){Qe=window,Xe=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;et=re(t,"firstChild").get,tt=re(t,"nextSibling").get,Be(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Be(n)&&(n.__t=void 0)}}function nt(e=""){return document.createTextNode(e)}function sn(e){return et.call(e)}function rt(e){return tt.call(e)}function it(e){var t=d,n=v;S(null),j(null);try{return e()}finally{S(t),j(n)}}function ln(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function ee(e,t,n){var r=v;r!==null&&(r.f&$)!==0&&(e|=$);var i={ctx:N,deps:null,nodes_start:null,nodes_end:null,f:e|x|I,first:null,fn:t,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{ae(i),i.f|=$e}catch(u){throw M(i),u}else t!==null&&X(i);var s=i;if(n&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&de)===0&&(s=s.first,(e&C)!==0&&(e&_e)!==0&&s!==null&&(s.f|=_e)),s!==null&&(s.parent=r,r!==null&&ln(s,r),d!==null&&(d.f&p)!==0&&(e&G)===0)){var o=d;(o.effects??=[]).push(s)}return i}function we(){return d!==null&&!F}function fn(e){return ee(Ae|Ot,e,!1)}function on(e){D.ensure();const t=ee(G|de,e,!0);return(n={})=>new Promise(r=>{n.outro?ye(t,()=>{M(t),r(void 0)}):(M(t),r(void 0))})}function un(e){return ee(Ae,e,!1)}function an(e,t=0){return ee(Ct|t,e,!0)}function cn(e,t=0){var n=ee(C|t,e,!0);return n}function H(e){return ee(K|de,e,!0)}function st(e){var t=e.teardown;if(t!==null){const n=fe,r=d;ut(!0),S(null);try{t.call(null)}finally{ut(n),S(r)}}}function lt(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const i=n.ac;i!==null&&it(()=>{i.abort(je)});var r=n.next;(n.f&G)!==0?n.parent=null:M(n,t),n=r}}function hn(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&K)===0&&M(t),t=n}}function M(e,t=!0){var n=!1;(t||(e.f&Le)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(_n(e.nodes_start,e.nodes_end),n=!0),lt(e,t&&!n),Ee(e,0),E(e,V);var r=e.transitions;if(r!==null)for(const s of r)s.stop();st(e);var i=e.parent;i!==null&&i.first!==null&&ft(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function _n(e,t){for(;e!==null;){var n=e===t?null:rt(e);e.remove(),e=n}}function ft(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function ye(e,t,n=!0){var r=[];ot(e,r,!0),dn(r,()=>{n&&M(e),t&&t()})}function dn(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var i of e)i.out(r)}else t()}function ot(e,t,n){if((e.f&$)===0){if(e.f^=$,e.transitions!==null)for(const o of e.transitions)(o.is_global||n)&&t.push(o);for(var r=e.first;r!==null;){var i=r.next,s=(r.f&_e)!==0||(r.f&K)!==0&&(e.f&C)!==0;ot(r,t,s?n:!1),r=i}}}function vn(e,t){for(var n=e.nodes_start,r=e.nodes_end;n!==null;){var i=n===r?null:rt(n);t.append(n),n=i}}let q=!1;function be(e){q=e}let fe=!1;function ut(e){fe=e}let d=null,F=!1;function S(e){d=e}let v=null;function j(e){v=e}let B=null;function pn(e){d!==null&&(B===null?B=[e]:B.push(e))}let m=null,k=0,T=null;function mn(e){T=e}let at=1,oe=0,W=oe;function ct(e){W=e}function ht(){return++at}function ue(e){var t=e.f;if((t&x)!==0)return!0;if(t&p&&(e.f&=~Y),(t&O)!==0){var n=e.deps;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i];if(ue(s)&&He(s),s.wv>e.wv)return!0}(t&I)!==0&&A===null&&E(e,w)}return!1}function _t(e,t,n=!0){var r=e.reactions;if(r!==null&&!B?.includes(e))for(var i=0;i<r.length;i++){var s=r[i];(s.f&p)!==0?_t(s,t,!1):t===s&&(n?E(s,x):(s.f&w)!==0&&E(s,O),X(s))}}function dt(e){var t=m,n=k,r=T,i=d,s=B,o=N,u=F,l=W,f=e.f;m=null,k=0,T=null,d=(f&(K|G))===0?e:null,B=null,ve(e.ctx),F=!1,W=++oe,e.ac!==null&&(it(()=>{e.ac.abort(je)}),e.ac=null);try{e.f|=Se;var h=e.fn,_=h(),a=e.deps;if(m!==null){var c;if(Ee(e,k),a!==null&&k>0)for(a.length=k+m.length,c=0;c<m.length;c++)a[k+c]=m[c];else e.deps=a=m;if(q&&we()&&(e.f&I)!==0)for(c=k;c<a.length;c++)(a[c].reactions??=[]).push(e)}else a!==null&&k<a.length&&(Ee(e,k),a.length=k);if(pe()&&T!==null&&!F&&a!==null&&(e.f&(p|O|x))===0)for(c=0;c<T.length;c++)_t(T[c],e);return i!==null&&i!==e&&(oe++,T!==null&&(r===null?r=T:r.push(...T))),(e.f&ie)!==0&&(e.f^=ie),_}catch(g){return Ke(g)}finally{e.f^=Se,m=t,k=n,T=r,d=i,B=s,ve(o),F=u,W=l}}function gn(e,t){let n=t.reactions;if(n!==null){var r=St.call(n,e);if(r!==-1){var i=n.length-1;i===0?n=t.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(t.f&p)!==0&&(m===null||!m.includes(t))&&(E(t,O),(t.f&I)!==0&&(t.f^=I,t.f&=~Y),ze(t),Ee(t,0))}function Ee(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)gn(e,n[r])}function ae(e){var t=e.f;if((t&V)===0){E(e,w);var n=v,r=q;v=e,q=!0;try{(t&C)!==0?hn(e):lt(e),st(e);var i=dt(e);e.teardown=typeof i=="function"?i:null,e.wv=at;var s;xe&&Gt&&(e.f&x)!==0&&e.deps}finally{q=r,v=n}}}function te(e){var t=e.f,n=(t&p)!==0;if(d!==null&&!F){var r=v!==null&&(v.f&V)!==0;if(!r&&!B?.includes(e)){var i=d.deps;if((d.f&Se)!==0)e.rv<oe&&(e.rv=oe,m===null&&i!==null&&i[k]===e?k++:m===null?m=[e]:m.includes(e)||m.push(e));else{(d.deps??=[]).push(e);var s=e.reactions;s===null?e.reactions=[d]:s.includes(d)||s.push(d)}}}if(fe){if(U.has(e))return U.get(e);if(n){var o=e,u=o.v;return((o.f&w)===0&&o.reactions!==null||pt(o))&&(u=Me(o)),U.set(o,u),u}}else n&&!A?.has(e)&&(o=e,ue(o)&&He(o),q&&we()&&(o.f&I)===0&&vt(o));if(A?.has(e))return A.get(e);if((e.f&ie)!==0)throw e.v;return e.v}function vt(e){if(e.deps!==null){e.f^=I;for(const t of e.deps)(t.reactions??=[]).push(e),(t.f&p)!==0&&(t.f&I)===0&&vt(t)}}function pt(e){if(e.v===y)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(U.has(t)||(t.f&p)!==0&&pt(t))return!0;return!1}function wn(e){var t=F;try{return F=!0,e()}finally{F=t}}const yn=-7169;function E(e,t){e.f=e.f&yn|t}const bn=["touchstart","touchmove"];function En(e){return bn.includes(e)}const kn=new Set,mt=new Set;let gt=null;function ke(e){var t=this,n=t.ownerDocument,r=e.type,i=e.composedPath?.()||[],s=i[0]||e.target;gt=e;var o=0,u=gt===e&&e.__root;if(u){var l=i.indexOf(u);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=i.indexOf(t);if(f===-1)return;l<=f&&(o=l)}if(s=i[o]||e.target,s!==t){It(e,"currentTarget",{configurable:!0,get(){return s||n}});var h=d,_=v;S(null),j(null);try{for(var a,c=[];s!==null;){var g=s.assignedSlot||s.parentNode||s.host||null;try{var Z=s["__"+r];Z!=null&&(!s.disabled||e.target===s)&&Z.call(s,e)}catch(J){a?c.push(J):a=J}if(e.cancelBubble||g===t||g===null)break;s=g}if(a){for(let J of c)queueMicrotask(()=>{throw J});throw a}}finally{e.__root=t,delete e.currentTarget,S(h),j(_)}}}function xn(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function An(e,t){var n=v;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function Sn(e,t){var n=(t&qt)!==0,r,i=!e.startsWith("<!>");return()=>{r===void 0&&(r=xn(i?e:"<!>"+e),r=sn(r));var s=n||Xe?document.importNode(r,!0):r.cloneNode(!0);return An(s,s),s}}function Tn(e,t){e!==null&&e.before(t)}function In(e,t){return Nn(e,t)}const ne=new Map;function Nn(e,{target:t,anchor:n,props:r={},events:i,context:s,intro:o=!0}){rn();var u=new Set,l=_=>{for(var a=0;a<_.length;a++){var c=_[a];if(!u.has(c)){u.add(c);var g=En(c);t.addEventListener(c,ke,{passive:g});var Z=ne.get(c);Z===void 0?(document.addEventListener(c,ke,{passive:g}),ne.set(c,1)):ne.set(c,Z+1)}}};l(Tt(kn)),mt.add(l);var f=void 0,h=on(()=>{var _=n??t.appendChild(nt());return Xt(_,{pending:()=>{}},a=>{if(s){Yt({});var c=N;c.c=s}i&&(r.$$events=i),f=e(a,r)||{},s&&zt()}),()=>{for(var a of u){t.removeEventListener(a,ke);var c=ne.get(a);--c===0?(document.removeEventListener(a,ke),ne.delete(a)):ne.set(a,c)}mt.delete(l),_!==n&&_.parentNode?.removeChild(_)}});return Rn.set(f,h),f}let Rn=new WeakMap;function Dn(e,t){un(()=>{var n=e.getRootNode(),r=n.host?n:n.head??n.ownerDocument.head;if(!r.querySelector("#"+t.hash)){const i=document.createElement("style");i.id=t.hash,i.textContent=t.code,r.appendChild(i)}})}const Mn="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Mn),Vt();var Fn=Sn('<div class="modal svelte-1wmebmf">aaa</div>');const Cn={hash:"svelte-1wmebmf",code:".modal.svelte-1wmebmf{background-color:black;opacity:0.9;}"};function On(e){Dn(e,Cn);var t=Fn();Tn(e,t)}class Pn{constructor(t,n="test"){this.storage=t,this.extId=n}async loadFile(t){return fetch(`https://m.ccw.site/user_projects_assets/${t}`)}async storeFile(t="text/plain",n,r="",i){let s;if(i instanceof String)s=new TextEncoder().encode(i).buffer;else if(i instanceof Blob)s=await i.arrayBuffer();else if(i instanceof Uint8Array)s=i.buffer;else if(i instanceof ArrayBuffer)s=i;else throw new Error(`cannot convert ${i} to array buffer`);return this.storage.store({contentType:t},r,s,n)}createUI(t){let n=t;return n||(n=document.createElement("div"),n.style.position="fixed",n.style.top="0px",n.style.left="0px",document.body.appendChild(n)),In(On,{target:n})}}const{BlockType:wt,ArgumentType:Oe}=Scratch;class Bn extends xt{constructor(t){super("spineAnimation","foo"),this.runtime=t,console.log(t),this.translate=kt(t),this.prepareInfo()}prepareInfo(){this.info.name=this.translate("spineAnimation.extensionName"),this.buildBlock(this.setSkinId,this.translate("spineAnimation.setSkinId.text"),wt.COMMAND,{arguments:{TARGET_NAME:{type:Oe.STRING,menu:"sprite_menu"},SKIN_ID:{type:Oe.NUMBER,default:"0"}}}),this.buildBlock(this.loadSkeleton,this.translate("spineAnimation.loadSkeleton.text"),wt.COMMAND,{arguments:{ID:{type:Oe.STRING,menu:"skeleton_menu"}}}),this.buildButton(this.initUI,"abcd"),this.buildMenu("sprite_menu",!0,this.spriteMenu),this.buildMenu("skeleton_menu",!0,this.skeletonMenu),console.log(this.info)}spriteMenu(){const t=[{text:this.translate("spineAnimation.spriteMenu.currentTarget"),value:"__this__"}];for(const n of this.runtime.targets)n.isSprite()&&n.id!==this.runtime.getEditingTarget()?.id&&t.push({text:n.sprite.name,value:n.sprite.name});return t}skeletonMenu(){return[{text:"test",value:"spine/Hina_home.skel"}]}setSkinId(t,n){const{TARGET_NAME:r,SKIN_ID:i}=t;let s;r==="__this__"?s=n.target:(s=this.runtime.targets.find(f=>f.isSprite()&&f.getName()===r),s||console.warn(`找不到名为${r}的角色`));const o=s.drawableID,u=this.runtime.renderer._allDrawables[o],l=this.runtime.renderer._allSkins[i];l&&(u.skin=l)}loadSkeleton(t){const{ID:n}=t}initUI(){const t=new Pn(this.runtime.storage,"spineAnimation");t.createUI(),console.log(t)}}ce(new Bn(Scratch.runtime))}));
